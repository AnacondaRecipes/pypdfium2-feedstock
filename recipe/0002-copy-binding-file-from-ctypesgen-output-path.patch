From 7945ff5752b9402d9640373525b58f582eeb4b0c Mon Sep 17 00:00:00 2001
From: Marek Waszkiewicz <mwaszkiewicz@anaconda.com>
Date: Thu, 31 Aug 2023 16:43:01 +0200
Subject: [PATCH 2/3] copy binding file from ctypesgen output path

---
 setupsrc/pypdfium2_setup/packaging_base.py | 14 ++++++++++----
 1 file changed, 10 insertions(+), 4 deletions(-)

diff --git a/setupsrc/pypdfium2_setup/packaging_base.py b/setupsrc/pypdfium2_setup/packaging_base.py
index 562ed57..b7bd383 100644
--- a/setupsrc/pypdfium2_setup/packaging_base.py
+++ b/setupsrc/pypdfium2_setup/packaging_base.py
@@ -282,10 +282,16 @@ def emplace_platfiles(pl_name):
     clean_platfiles()
     platfiles = get_platfiles(pl_name)
     
-    for fp in platfiles:
-        if not fp.exists():
-            raise RuntimeError(f"Platform file missing: {fp}")
-        shutil.copy(fp, ModuleDir)
+    # use SRC_DIR/bindings/raw.py as a source for the raw bindings, because all other files
+    # i.e. $SRC_DIR/data/<arch>/raw.py and $SRC_DIR/src/pypdfium2/raw.py are somehow invalid
+    raw_bindings = SourceTree / "bindings" / BindingsFileName
+    if raw_bindings.exists():
+        shutil.copy(raw_bindings, ModuleDir)
+    else:
+        for fp in platfiles:
+            if not fp.exists():
+                raise RuntimeError(f"Platform file missing: {fp}")
+            shutil.copy(fp, ModuleDir)
 
 
 def get_changelog_staging(flush=False):
-- 
2.25.1

